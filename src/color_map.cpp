#include "color_map.h"

namespace HexaLab {

	static const vector<Vector3f> color_map_parula = // https://github.com/BIDS/colormap
	{
		{0.2081f,       0.1663f,        0.5292f},
		{0.2116238095f, 0.1897809524f,  0.5776761905f},
		{0.212252381f,  0.2137714286f,  0.6269714286f},
		{0.2081f,       0.2386f,        0.6770857143f},
		{0.1959047619f, 0.2644571429f,  0.7279f},
		{0.1707285714f, 0.2919380952f,  0.779247619f},
		{0.1252714286f, 0.3242428571f,  0.8302714286f},
		{0.0591333333f, 0.3598333333f,  0.8683333333f},
		{0.0116952381f, 0.3875095238f,  0.8819571429f},
		{0.0059571429f, 0.4086142857f,  0.8828428571f},
		{0.0165142857f, 0.4266f,        0.8786333333f},
		{0.032852381f,  0.4430428571f,  0.8719571429f},
		{0.0498142857f, 0.4585714286f,  0.8640571429f},
		{0.0629333333f, 0.4736904762f,  0.8554380952f},
		{0.0722666667f, 0.4886666667f,  0.8467f},
		{0.0779428571f, 0.5039857143f,  0.8383714286f},
		{0.079347619f,  0.5200238095f,  0.8311809524f},
		{0.0749428571f, 0.5375428571f,  0.8262714286f},
		{0.0640571429f, 0.5569857143f,  0.8239571429f},
		{0.0487714286f, 0.5772238095f,  0.8228285714f},
		{0.0343428571f, 0.5965809524f,  0.819852381f},
		{0.0265f,       0.6137f,        0.8135f},
		{0.0238904762f, 0.6286619048f,  0.8037619048f},
		{0.0230904762f, 0.6417857143f,  0.7912666667f},
		{0.0227714286f, 0.6534857143f,  0.7767571429f},
		{0.0266619048f, 0.6641952381f,  0.7607190476f},
		{0.0383714286f, 0.6742714286f,  0.743552381f},
		{0.0589714286f, 0.6837571429f,  0.7253857143f},
		{0.0843f,       0.6928333333f,  0.7061666667f},
		{0.1132952381f, 0.7015f,        0.6858571429f},
		{0.1452714286f, 0.7097571429f,  0.6646285714f},
		{0.1801333333f, 0.7176571429f,  0.6424333333f},
		{0.2178285714f, 0.7250428571f,  0.6192619048f},
		{0.2586428571f, 0.7317142857f,  0.5954285714f},
		{0.3021714286f, 0.7376047619f,  0.5711857143f},
		{0.3481666667f, 0.7424333333f,  0.5472666667f},
		{0.3952571429f, 0.7459f,        0.5244428571f},
		{0.4420095238f, 0.7480809524f,  0.5033142857f},
		{0.4871238095f, 0.7490619048f,  0.4839761905f},
		{0.5300285714f, 0.7491142857f,  0.4661142857f},
		{0.5708571429f, 0.7485190476f,  0.4493904762f},
		{0.609852381f,  0.7473142857f,  0.4336857143f},
		{0.6473f,       0.7456f,        0.4188f},
		{0.6834190476f, 0.7434761905f,  0.4044333333f},
		{0.7184095238f, 0.7411333333f,  0.3904761905f},
		{0.7524857143f, 0.7384f,        0.3768142857f},
		{0.7858428571f, 0.7355666667f,  0.3632714286f},
		{0.8185047619f, 0.7327333333f,  0.3497904762f},
		{0.8506571429f, 0.7299f,        0.3360285714f},
		{0.8824333333f, 0.7274333333f,  0.3217f},
		{0.9139333333f, 0.7257857143f,  0.3062761905f},
		{0.9449571429f, 0.7261142857f,  0.2886428571f},
		{0.9738952381f, 0.7313952381f,  0.266647619f},
		{0.9937714286f, 0.7454571429f,  0.240347619f},
		{0.9990428571f, 0.7653142857f,  0.2164142857f},
		{0.9955333333f, 0.7860571429f,  0.196652381f},
		{0.988f,        0.8066f,        0.1793666667f},
		{0.9788571429f, 0.8271428571f,  0.1633142857f},
		{0.9697f,       0.8481380952f,  0.147452381f},
		{0.9625857143f, 0.8705142857f,  0.1309f},
		{0.9588714286f, 0.8949f,        0.1132428571f},
		{0.9598238095f, 0.9218333333f,  0.0948380952f},
		{0.9661f,       0.9514428571f,  0.0755333333f},
		{0.9763f,       0.9831f,        0.0538f},
	};

	static const vector<Vector3f> color_map_jet = {	// https://bugs.launchpad.net/inkscape/+bug/236508
		{0.f,           0.f,            0.498039216f},
		{0.f,           0.f,            0.498039216f},
		{0.f,           0.f,            0.552941176f},
		{0.f,           0.f,            0.607843137f},
		{0.f,           0.f,            0.662745098f},
		{0.f,           0.f,            0.717647059f},
		{0.f,           0.f,            0.776470588f},
		{0.f,           0.f,            0.831372549f},
		{0.f,           0.f,            0.88627451f},
		{0.f,           0.f,            0.941176471f},
		{0.f,           0.f,            1.f },
		{0.f,           0.054901961f,   1.f },
		{0.f,           0.109803922f,   1.f },
		{0.f,           0.164705882f,   1.f },
		{0.f,           0.219607843f,   1.f },
		{0.f,           0.274509804f,   1.f },
		{0.f,           0.329411765f,   1.f },
		{0.f,           0.384313725f,   1.f },
		{0.f,           0.439215686f,   1.f },
		{0.f,           0.498039216f,   1.f },
		{0.f,           0.552941176f,   1.f },
		{0.f,           0.607843137f,   1.f },
		{0.f,           0.662745098f,   1.f },
		{0.f,           0.717647059f,   1.f },
		{0.f,           0.776470588f,   1.f },
		{0.f,           0.831372549f,   1.f },
		{0.f,           0.88627451f,    1.f },
		{0.f,           0.941176471f,   1.f },
		{0.f,           1.f,            1.f },
		{0.054901961f,  1.f,            0.941176471f},
		{0.109803922f,  1.f,            0.88627451f},
		{0.164705882f,  1.f,            0.831372549f},
		{0.219607843f,  1.f,            0.776470588f},
		{0.274509804f,  1.f,            0.717647059f},
		{0.329411765f,  1.f,            0.662745098f},
		{0.384313725f,  1.f,            0.607843137f},
		{0.439215686f,  1.f,            0.552941176f},
		{0.498039216f,  1.f,            0.498039216f},
		{0.552941176f,  1.f,            0.439215686f},
		{0.607843137f,  1.f,            0.384313725f},
		{0.662745098f,  1.f,            0.329411765f},
		{0.717647059f,  1.f,            0.274509804f},
		{0.776470588f,  1.f,            0.219607843f},
		{0.831372549f,  1.f,            0.164705882f},
		{0.88627451f,   1.f,            0.109803922f},
		{0.941176471f,  1.f,            0.054901961f},
		{1.f,           1.f,            0.f },
		{1.f,           0.941176471f,   0.f },
		{1.f,           0.88627451f,    0.f },
		{1.f,           0.831372549f,   0.f },
		{1.f,           0.776470588f,   0.f },
		{1.f,           0.717647059f,   0.f },
		{1.f,           0.662745098f,   0.f },
		{1.f,           0.607843137f,   0.f },
		{1.f,           0.552941176f,   0.f },
		{1.f,           0.498039216f,   0.f },
		{1.f,           0.439215686f,   0.f },
		{1.f,           0.384313725f,   0.f },
		{1.f,           0.329411765f,   0.f },
		{1.f,           0.274509804f,   0.f },
		{1.f,           0.219607843f,   0.f },
		{1.f,           0.164705882f,   0.f },
		{1.f,           0.109803922f,   0.f },
		{1.f,           0.054901961f,   0.f },
		{1.f,           0.f,            0.f },
		{0.941176471f,  0.f,            0.f },
		{0.88627451f,   0.f,            0.f },
		{0.831372549f,  0.f,            0.f },
		{0.776470588f,  0.f,            0.f },
		{0.717647059f,  0.f,            0.f },
		{0.662745098f,  0.f,            0.f },
		{0.607843137f,  0.f,            0.f },
		{0.552941176f,  0.f,            0.f },
	};

	static const vector<Vector3f> color_map_red_blue = {
		{0.f,           0.f,            1.f},
		{1.f,           1.f,            1.f},
		{1.f,           0.f,            0.f},
	};

	ColorMap::Palette ColorMap::default_palette = ColorMap::Palette::Parula;

	ColorMap::ColorMap(Palette palette) {
	start:
		switch (palette) {
		case Palette::Parula:
			this->palette = &color_map_parula;
			break;
		case Palette::Jet:
			this->palette = &color_map_jet;
			break;
		case Palette::RedBlue:
			this->palette = &color_map_red_blue;
			break;
		default:
			HL_LOG("[Color Map] Palette name unrecognized. Default palette selected.");
			palette = default_palette;
			goto start;
		}
		this->palette_enum = palette;
	}

	Vector3f ColorMap::get(float value) {
		value = 1 - value;
        float x = float(palette->size() - 1) * value;
        int i = int(x);
		if (i + 1 >= palette->size()) {
			return palette->back();
		}
		float t = x - i;
		return (*palette)[i] * (1 - t) + (*palette)[i + 1] * t;
	}
}
